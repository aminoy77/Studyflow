<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyFlow - Diagn√≥stico</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-8">
        <h1 class="text-3xl font-bold mb-6">üîç Diagn√≥stico de Firebase</h1>
        
        <div id="results" class="space-y-4">
            <p class="text-gray-600">Ejecutando diagn√≥stico...</p>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script src="js/firebase-config.js"></script>
    
    <script>
        const results = document.getElementById('results');
        
        function addResult(message, type = 'info') {
            const colors = {
                success: 'bg-green-50 border-green-200 text-green-800',
                error: 'bg-red-50 border-red-200 text-red-800',
                warning: 'bg-yellow-50 border-yellow-200 text-yellow-800',
                info: 'bg-blue-50 border-blue-200 text-blue-800'
            };
            
            const div = document.createElement('div');
            div.className = `p-4 rounded border ${colors[type]}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        results.innerHTML = '';
        
        // Test 1: Firebase SDK cargado
        if (typeof firebase === 'undefined') {
            addResult('‚ùå Firebase SDK NO est√° cargado', 'error');
            addResult('Soluci√≥n: Verifica tu conexi√≥n a internet', 'warning');
        } else {
            addResult('‚úÖ Firebase SDK cargado correctamente', 'success');
        }
        
        // Test 2: Firebase inicializado
        try {
            const apps = firebase.apps;
            if (apps.length === 0) {
                addResult('‚ùå Firebase NO est√° inicializado', 'error');
                addResult('Soluci√≥n: Verifica que firebase-config.js tiene tu configuraci√≥n correcta', 'warning');
            } else {
                addResult('‚úÖ Firebase est√° inicializado', 'success');
                
                // Mostrar configuraci√≥n (sin datos sensibles)
                const config = apps[0].options;
                addResult(`
                    <strong>Configuraci√≥n actual:</strong><br>
                    ‚Ä¢ Project ID: ${config.projectId || '‚ùå NO CONFIGURADO'}<br>
                    ‚Ä¢ Auth Domain: ${config.authDomain || '‚ùå NO CONFIGURADO'}<br>
                    ‚Ä¢ API Key: ${config.apiKey ? '‚úÖ Configurado' : '‚ùå NO CONFIGURADO'}
                `, config.projectId && config.authDomain && config.apiKey ? 'success' : 'error');
            }
        } catch (error) {
            addResult('‚ùå Error al verificar Firebase: ' + error.message, 'error');
        }
        
        // Test 3: Firebase Auth disponible
        try {
            const auth = firebase.auth();
            if (auth) {
                addResult('‚úÖ Firebase Authentication disponible', 'success');
            } else {
                addResult('‚ùå Firebase Authentication NO disponible', 'error');
            }
        } catch (error) {
            addResult('‚ùå Error al acceder a Auth: ' + error.message, 'error');
        }
        
        // Test 4: Firestore disponible
        try {
            const db = firebase.firestore();
            if (db) {
                addResult('‚úÖ Firestore disponible', 'success');
            } else {
                addResult('‚ùå Firestore NO disponible', 'error');
            }
        } catch (error) {
            addResult('‚ùå Error al acceder a Firestore: ' + error.message, 'error');
        }
        
        // Test 5: Probar autenticaci√≥n
        addResult('<strong>Test de autenticaci√≥n:</strong><br>Intentando crear usuario de prueba...', 'info');
        
        const testEmail = `test${Date.now()}@studyflow.test`;
        const testPassword = 'test123456';
        
        firebase.auth().createUserWithEmailAndPassword(testEmail, testPassword)
            .then((userCredential) => {
                addResult('‚úÖ ¬°Autenticaci√≥n funciona! Usuario de prueba creado', 'success');
                // Eliminar usuario de prueba
                return userCredential.user.delete();
            })
            .then(() => {
                addResult('‚úÖ Usuario de prueba eliminado correctamente', 'success');
                addResult(`
                    <strong>üéâ TODO FUNCIONA CORRECTAMENTE</strong><br><br>
                    Tu configuraci√≥n de Firebase est√° bien.<br>
                    Puedes volver a <a href="index.html" class="underline font-bold">index.html</a> y registrarte normalmente.
                `, 'success');
            })
            .catch((error) => {
                addResult(`
                    <strong>‚ùå Error en autenticaci√≥n:</strong><br>
                    C√≥digo: ${error.code}<br>
                    Mensaje: ${error.message}<br><br>
                    <strong>Posibles causas:</strong><br>
                    ${getErrorSolution(error.code)}
                `, 'error');
            });
        
        function getErrorSolution(errorCode) {
            const solutions = {
                'auth/api-key-not-valid': '‚Ä¢ Tu API Key no es v√°lida. Verifica que copiaste correctamente la configuraci√≥n de Firebase Console',
                'auth/invalid-api-key': '‚Ä¢ Tu API Key no es v√°lida. Verifica que copiaste correctamente la configuraci√≥n de Firebase Console',
                'auth/app-not-authorized': '‚Ä¢ Authentication no est√° activado en Firebase Console. Ve a Authentication > Sign-in method y activa Email/Password',
                'auth/operation-not-allowed': '‚Ä¢ Email/Password no est√° habilitado. Ve a Firebase Console > Authentication > Sign-in method y act√≠valo',
                'auth/project-not-found': '‚Ä¢ El Project ID no existe. Verifica tu configuraci√≥n en firebase-config.js',
                'auth/network-request-failed': '‚Ä¢ Error de red. Verifica tu conexi√≥n a internet'
            };
            
            return solutions[errorCode] || '‚Ä¢ Error desconocido. Comparte este c√≥digo de error para ayudarte mejor.';
        }
    </script>
</body>
</html>
